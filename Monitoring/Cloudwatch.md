# Cloudwatch

Is the native monitoring tool integrated on all AWS Resources.
It is composed by several services.

## Cloudwatch Metrics

All the services publish automaticalle some key metrics in Cloudwatch to make able the monitoring of the platform.

An example of these metrics is CPU in an EC2 instance, or another example is Read IOPS in an RDS instance.

You can select to view a metric based on resources or group of resources.

By default, Cloudwatch publish a data point every 5 minutes, but you can enable detailed monitoring (non-free feature) to obtain a data point per-minute.

Cloudwatch has a maximum data retention of 15 months. You can select every time range within 15 months to view metrics.

Not all kind of metrics are retained 15 months.
- Data points with a period of less than 60 seconds are available for 3 hours.
- Data points with a period of 1 minute are available for 15 days.
- Data points with a period of 300 seconds are available for 63 days.
- Data points with a period of 1 hour are available for 15 months.

_Note: Elasticsearch is configurable with accuracy and retain time._

### Custom Metrics
Some metrics like RAM memory aren't available by default in Cloudwatch.

You can create custom metrics using AWS CLI or installing the Cloudwatch Agent for EC2.

You can customize till 10 dimensions when publish a custom metric in cloudwatch.

You can also export metrics outside of Cloudwatch using AWS CLI.

## Cloudwatch Alarms

Alarms allows you to automatize actions based on environment behaviors.

You can't create cloudwatch alarms with combined metrics. (Possible exam question)

When an alert is triggered you can configure an SNS Notification, an AutoScaling Action, an EC2 action or create an incident associate to a Response Plan on Incident Manager.

Also you can create Billing Alarms in us-east-1 (North Virginia) region.

## Cloudwatch Logs

Is composed by Log Groups and Log Streams.

A Log Group is composed by many Log Streams related to the same Log Group, usually associated to a Service.

By default, the data available has no retention, but it's configurable.

You can define Metric filters in each log group to filter messages and create alarms based on that filters.

Log Groups is also integrable with Kinesis to make a real-time processing log environment.

### Kind of logs
- Application logs: Logs produced by your application code.
Usually streamed to CW Logs using a Cloudwatch Agents.
Lambda, ECS and Beanstalk has direct integration with CW Logs

- Operating System Logs: Logs generated by your operating system
Usually streamed to CW using a CW Agent.

- Access Logs: List all of the request for individual files that people have requested from a website.
Usually for load balancers, proxies...
  - Managed Logs:
    - Load Balancer Access Logs -> To s3
    - Cloudtrail Logs -> To s3 and CW   Logs
    - VPC Flow Logs -> To s3 and CW Logs
    - Route53 Access Logs -> To CW Logs
    - S3 Access Logs -> To another S3
    - Cloudfront Access Logs -> to s3

## Cloudwatch Agent

Is an Agent that you can install on your EC2 instances to send custom metrics and logs to Cloudwatch.

To send logs and metrics you need to write some config files before run the agent. Files can be store locally or using an SSM Parameter.

## Cloudwatch Events

Cloudwatch events is the source of many automations in AWS.

Events are based on rules that matches patterns with all events happened in AWS Environment to trigger this event.

Event is the source trigger for future actions.

There are Scheduled events, that can provide us a schedule trigger for services as needed.

To intercept API calls you need to integrate events with Cloudtrail API Calls event type. 
_NOTE: Read-only apis like List, Get or Describe are not supported by Cloudtrail API Calls_

You can configure the following as targets for Events:

- API destination
- API Gateway
- Batch job queue
- CloudWatch group
- CodeBuild project
- CodePipeline
- EC2 CreateSnapshot API call
- EC2 Image Builder
- EC2 RebootInstances API call
- EC2 StopInstances API call
- EC2 TerminateInstances API call
- ECS task
- Event bus
- Firehose delivery stream
- Glue workflow
- Incident Manager response plan
- Inspector assessment template
- Kinesis stream
- Lambda function
- Redshift cluster
- SageMaker Pipeline
- SNS topic
- SQS queue
- Step Functions state machine
- Systems Manager Automation
- Systems Manager Run Command


S3 Events are totally unrelated with Cloudwatch Events.
Amazon S3 can send event notification messages to the following destinations. You specify the Amazon Resource Name (ARN) value of these destinations in the notification configuration.

- Amazon Simple Notification Service (Amazon SNS) topics
- Amazon Simple Queue Service (Amazon SQS) queues
- AWS Lambda function

---------------
[Go Home](../README.md)